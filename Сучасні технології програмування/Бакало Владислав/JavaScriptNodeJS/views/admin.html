<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å | TechStore</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ */
        .admin-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #2b2d42 0%, #212529 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .admin-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .admin-subtitle {
            color: #8d99ae;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4cc9f0;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #8d99ae;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .admin-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1024px) {
            .admin-content {
                grid-template-columns: 1fr;
            }
        }
        
        .orders-section, .upload-section {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #2b2d42;
            border: 2px solid #e0e0e0;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f94144 0%, #f3722c 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .orders-list {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .order-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #4361ee;
            transition: all 0.3s ease;
        }
        
        .order-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .order-id {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: #2b2d42;
            font-size: 1.1rem;
        }
        
        .order-date {
            color: #8d99ae;
            font-size: 0.9rem;
        }
        
        .order-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-processed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        .customer-info {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .info-item {
            margin-bottom: 8px;
        }
        
        .info-label {
            color: #8d99ae;
            font-size: 0.85rem;
            margin-bottom: 3px;
        }
        
        .info-value {
            color: #2b2d42;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .order-items {
            margin-top: 15px;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .items-table th {
            background: #e9ecef;
            color: #2b2d42;
            font-weight: 600;
            text-align: left;
            padding: 12px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .items-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }
        
        .order-total {
            text-align: right;
            font-weight: 700;
            color: #2b2d42;
            font-size: 1.1rem;
            margin-top: 15px;
        }
        
        .upload-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2b2d42;
            font-family: 'Poppins', sans-serif;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .preview-image {
            width: 100%;
            max-width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px dashed #e0e0e0;
            padding: 10px;
            background: white;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: block;
            padding: 40px 20px;
            background: white;
            border: 2px dashed #4361ee;
            border-radius: 8px;
            text-align: center;
            color: #4361ee;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-label:hover {
            background: #f0f2ff;
            border-color: #3a0ca3;
        }
        
        .empty-orders {
            text-align: center;
            padding: 50px 20px;
            color: #8d99ae;
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-left-color: #4361ee;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success {
            background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);
            border-left: 4px solid #4361ee;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #f94144 0%, #f3722c 100%);
            border-left: 4px solid #f8961e;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #4361ee;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            color: #3a0ca3;
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <a href="/" class="back-btn">
            ‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω
        </a>
        
        <div class="admin-header">
            <div class="admin-title">
                <span></span> –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å TechStore
            </div>
            <div class="admin-subtitle">
                –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏ —Ç–∞ —Ç–æ–≤–∞—Ä–∞–º–∏
            </div>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingOrders">0</div>
                    <div class="stat-label">–û—á—ñ–∫—É—é—Ç—å –æ–±—Ä–æ–±–∫–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">$<span id="totalRevenue">0</span></div>
                    <div class="stat-label">–ó–∞–≥–∞–ª—å–Ω–∏–π –¥–æ—Ö—ñ–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayOrders">0</div>
                    <div class="stat-label">–°—å–æ–≥–æ–¥–Ω—ñ</div>
                </div>
            </div>
        </div>
        
        <div class="admin-content">
            <div class="orders-section">
                <div class="section-header">
                    <h2>–û—Å—Ç–∞–Ω–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
                    <div class="section-actions">
                        <button onclick="refreshOrders()" class="btn btn-primary">
                            <span>üîÑ</span> –û–Ω–æ–≤–∏—Ç–∏
                        </button>
                        <button onclick="clearOrdersFile()" class="btn btn-danger">
                            <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–∞–π–ª
                        </button>
                        <button onclick="exportOrders()" class="btn btn-success">
                            <span>üì•</span> –ï–∫—Å–ø–æ—Ä—Ç
                        </button>
                    </div>
                </div>
                
                <div class="orders-list" id="ordersList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 15px; color: #8d99ae;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...</p>
                    </div>
                </div>
            </div>
            
            <div class="upload-section">
                <h2>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä</h2>
                <p style="color: #8d99ae; margin-bottom: 20px;">
                    –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ —Ç–∞ –¥–æ–¥–∞–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–æ–≤–∞—Ä
                </p>
                
                <div class="upload-form">
                    <form id="uploadForm">
                        <div class="form-group">
                            <label for="productName">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É *</label>
                            <input type="text" id="productName" required placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: iPhone 15 Pro">
                        </div>
                        
                        <div class="form-group">
                            <label for="productPrice">–¶—ñ–Ω–∞ ($) *</label>
                            <input type="number" id="productPrice" required placeholder="999" min="1" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è *</label>
                            <select id="productCategory" required>
                                <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                                <option value="phones">–¢–µ–ª–µ—Ñ–æ–Ω–∏</option>
                                <option value="laptops">–ù–æ—É—Ç–±—É–∫–∏</option>
                                <option value="tablets">–ü–ª–∞–Ω—à–µ—Ç–∏</option>
                                <option value="watches">–ì–æ–¥–∏–Ω–Ω–∏–∫–∏</option>
                                <option value="accessories">–ê–∫—Å–µ—Å—É–∞—Ä–∏</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDescription">–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É</label>
                            <textarea id="productDescription" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —Ç–æ–≤–∞—Ä—É..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDiscount">–ó–Ω–∏–∂–∫–∞ (%)</label>
                            <input type="number" id="productDiscount" placeholder="0" min="0" max="100">
                        </div>
                        
                        <div class="form-group">
                            <label>–§–æ—Ç–æ —Ç–æ–≤–∞—Ä—É *</label>
                            <div class="file-upload">
                                <input type="file" id="productImage" accept="image/*" required>
                                <label for="productImage" class="file-upload-label">
                                    <div style="font-size: 2rem;">üì§</div>
                                    <div style="margin-top: 10px;">–ö–ª–∞—Ü–Ω—ñ—Ç—å –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ</div>
                                    <div style="font-size: 0.85rem; color: #8d99ae; margin-top: 5px;">
                                        JPG, PNG, WEBP (–¥–æ 5MB)
                                    </div>
                                </label>
                            </div>
                            <img id="imagePreview" class="preview-image" style="display: none;">
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                            <span>‚ûï</span> –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
                        </button>
                    </form>
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <h3 style="margin-bottom: 15px; color: #2b2d42;">‚ÑπÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ–∞–π–ª –∑–∞–º–æ–≤–ª–µ–Ω—å</h3>
                    <p style="color: #8d99ae; margin-bottom: 10px; font-size: 0.95rem;">
                        –í—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ <code>orders.txt</code> —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É.
                    </p>
                    <p style="color: #8d99ae; font-size: 0.95rem;">
                        –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É: <code>./orders.txt</code>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AdminPanel {
            constructor() {
                this.orders = [];
                this.init();
            }
            
            async init() {
                await this.loadOrders();
                this.setupEventListeners();
                this.setupImagePreview();
                this.updateStats();
            }
            
           async loadOrders() {
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p style="margin-top: 15px; color: #8d99ae;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...</p>
            </div>
        `;
        
        try {
            const response = await fetch('/api/orders');
            const data = await response.json();
            
            if (data.orders) {
                this.parseOrders(data.orders);
                this.renderOrders();
            } else {
                this.showEmptyMessage();
            }
        } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å:', error);
            this.showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å');
        }
    }
    
    parseOrders(ordersText) {
        this.orders = [];
        
        if (!ordersText.trim()) {
            console.log('–§–∞–π–ª orders.txt –ø–æ—Ä–æ–∂–Ω—ñ–π');
            return;
        }
        
        console.log('–í–º—ñ—Å—Ç —Ñ–∞–π–ª—É:', ordersText);
        
        // –ü—Ä–æ—Å—Ç–∏–π –ø–∞—Ä—Å–∏–Ω–≥
        const lines = ordersText.split('\n');
        let currentOrder = null;
        
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            // –®—É–∫–∞—î–º–æ –ø–æ—á–∞—Ç–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
            if (line.includes('–ó–ê–ú–û–í–õ–ï–ù–ù–Ø #') || line.includes('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #')) {
                if (currentOrder) {
                    this.orders.push(currentOrder);
                }
                
                const idMatch = line.match(/#(\d+)/);
                currentOrder = {
                    id: idMatch ? idMatch[1] : 'N/A',
                    date: '',
                    customer: { name: '', email: '', phone: '', address: '', payment: '' },
                    items: [],
                    total: '0',
                    status: '–û—á—ñ–∫—É—î –æ–±—Ä–æ–±–∫–∏'
                };
                
                // –®—É–∫–∞—î–º–æ –¥–∞—Ç—É –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ä—è–¥–∫–∞—Ö
                for (let j = i + 1; j < Math.min(i + 5, lines.length); j++) {
                    if (lines[j].includes('–î–∞—Ç–∞:')) {
                        currentOrder.date = lines[j].replace('–î–∞—Ç–∞:', '').trim();
                        break;
                    }
                }
            }
            
            // –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–ª—ñ—î–Ω—Ç–∞
            if (currentOrder) {
                if (line.includes('–Ü–º\'—è:')) {
                    currentOrder.customer.name = line.replace('‚Ä¢ –Ü–º\'—è:', '').replace('–Ü–º\'—è:', '').trim();
                }
                if (line.includes('Email:')) {
                    currentOrder.customer.email = line.replace('‚Ä¢ Email:', '').replace('Email:', '').trim();
                }
                if (line.includes('–¢–µ–ª–µ—Ñ–æ–Ω:')) {
                    currentOrder.customer.phone = line.replace('‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω:', '').replace('–¢–µ–ª–µ—Ñ–æ–Ω:', '').trim();
                }
                if (line.includes('–ê–¥—Ä–µ—Å–∞:')) {
                    currentOrder.customer.address = line.replace('‚Ä¢ –ê–¥—Ä–µ—Å–∞:', '').replace('–ê–¥—Ä–µ—Å–∞:', '').trim();
                }
                if (line.includes('–û–ø–ª–∞—Ç–∞:')) {
                    currentOrder.customer.payment = line.replace('‚Ä¢ –û–ø–ª–∞—Ç–∞:', '').replace('–û–ø–ª–∞—Ç–∞:', '').trim();
                }
                if (line.includes('–î–æ —Å–ø–ª–∞—Ç–∏:')) {
                    const totalMatch = line.match(/\$([\d.]+)/);
                    if (totalMatch) {
                        currentOrder.total = totalMatch[1];
                    }
                    
                }
                
                // –ü—Ä–æ—Å—Ç–∏–π –ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä—ñ–≤
                if (line.includes('‚Ä¢') && line.includes('x') && !line.includes('‚Üí')) {
                    const itemMatch = line.match(/‚Ä¢\s*(.+?)\s*x(\d+)/);
                    if (itemMatch && currentOrder) {
                        currentOrder.items.push({
                            name: itemMatch[1].trim(),
                            quantity: parseInt(itemMatch[2])
                        });
                    }
                }
            }
        }
        
        // –î–æ–¥–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        if (currentOrder) {
            this.orders.push(currentOrder);
        }
        
        console.log('–ó–Ω–∞–π–¥–µ–Ω–æ –∑–∞–º–æ–≤–ª–µ–Ω—å:', this.orders.length);
    }
    
    renderOrders() {
        const ordersList = document.getElementById('ordersList');
        
        console.log('renderOrders –≤–∏–∫–ª–∏–∫–∞–Ω–æ, –∑–∞–º–æ–≤–ª–µ–Ω—å:', this.orders.length);
        
        if (this.orders.length === 0) {
            this.showEmptyMessage();
            return;
        }
        
        // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –¥–∞—Ç–æ—é (–Ω–æ–≤—ñ –ø–µ—Ä—à—ñ)
        const sortedOrders = [...this.orders].sort((a, b) => {
            // –Ø–∫—â–æ –¥–∞—Ç–∞ –Ω–µ –≤–∞–ª—ñ–¥–Ω–∞, —Å—Ç–∞–≤–∏–º–æ –≤ –∫—ñ–Ω–µ—Ü—å
            const dateA = new Date(a.date);
            const dateB = new Date(b.date);
            return isNaN(dateB) ? -1 : (isNaN(dateA) ? 1 : dateB - dateA);
        });
        
        ordersList.innerHTML = sortedOrders.map(order => `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <div class="order-id">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${order.id}</div>
                        <div class="order-date">${order.date || '–î–∞—Ç–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞'}</div>
                    </div>
                    <div class="order-status status-pending">
                        ${order.status || '–û—á—ñ–∫—É—î –æ–±—Ä–æ–±–∫–∏'}
                    </div>
                </div>
                
                <div class="customer-info">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">–ö–ª—ñ—î–Ω—Ç</div>
                            <div class="info-value">${order.customer.name || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                            <div class="info-value">${order.customer.phone || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Email</div>
                            <div class="info-value">${order.customer.email || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–ê–¥—Ä–µ—Å–∞</div>
                            <div class="info-value">${order.customer.address || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–û–ø–ª–∞—Ç–∞</div>
                            <div class="info-value">${order.customer.payment || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="order-items">
                    ${order.items && order.items.length > 0 ? `
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td>${item.name || '–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–æ–≤–∞—Ä'}</td>
                                        <td>${item.quantity || 1}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p>–¢–æ–≤–∞—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</p>'}
                </div>
                
                <div class="order-total">
                    –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: $${order.total || '0.00'}
                </div>
            </div>
        `).join('');
        
        this.updateStats();
    }
    
    showEmptyMessage() {
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = `
            <div class="empty-orders">
                <div class="empty-icon">üì≠</div>
                <h3 style="color: #2b2d42; margin-bottom: 10px;">–ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î</h3>
                <p style="color: #8d99ae;">–©–µ –Ω–µ –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.</p>
                <button onclick="createTestOrder()" class="btn btn-primary" style="margin-top: 20px;">
                    –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </button>
            </div>
        `;
    }
    
    updateStats() {
        document.getElementById('totalOrders').textContent = this.orders.length;
        
        const today = new Date().toLocaleDateString('uk-UA');
        const todayOrders = this.orders.filter(order => 
            order.date && order.date.includes(today.split(',')[0])
        ).length;
        document.getElementById('todayOrders').textContent = todayOrders;
        
        const pendingOrders = this.orders.filter(order => 
            order.status && order.status.includes('–û—á—ñ–∫—É—î')
        ).length;
        document.getElementById('pendingOrders').textContent = pendingOrders;
        
        const totalRevenue = this.orders.reduce((sum, order) => {
            const total = parseFloat(order.total) || 0;
            return sum + total;
        }, 0);
        document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2);
    }
    
    setupEventListeners() {
        // –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
        const uploadForm = document.getElementById('uploadForm');
        if (uploadForm) {
            uploadForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.addProduct();
            });
        }
    }
    
    setupImagePreview() {
        const imageInput = document.getElementById('productImage');
        const preview = document.getElementById('imagePreview');
        
        if (imageInput && preview) {
            imageInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    }
            
            async addProduct() {
                const formData = new FormData();
                formData.append('image', document.getElementById('productImage').files[0]);
                
                try {
                    // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ñ–æ—Ç–æ
                    const uploadResponse = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const uploadResult = await uploadResponse.json();
                    
                    if (!uploadResult.success) {
                        throw new Error(uploadResult.error);
                    }
                    
                    // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä
                    const newProduct = {
                        name: document.getElementById('productName').value,
                        price: parseFloat(document.getElementById('productPrice').value),
                        category: document.getElementById('productCategory').value,
                        description: document.getElementById('productDescription').value,
                        discount: parseInt(document.getElementById('productDiscount').value) || 0,
                        image: uploadResult.path,
                        rating: 4.5,
                        inStock: true
                    };
                    
                    this.showNotification('–¢–æ–≤–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
                    
                    // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
                    document.getElementById('uploadForm').reset();
                    document.getElementById('imagePreview').style.display = 'none';
                    
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É:', error);
                    this.showNotification('–ü–æ–º–∏–ª–∫–∞: ' + error.message, 'error');
                }
            }
            
            async clearOrdersFile() {
                if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ —Ñ–∞–π–ª –∑–∞–º–æ–≤–ª–µ–Ω—å? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.')) {
                    return;
                }
                
                try {
                    this.showNotification('–§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è —Ñ–∞–π–ª—É –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ API', 'error');
                }   catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—á–∏—â–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É:', error);
                    this.showNotification('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—á–∏—â–µ–Ω–Ω—ñ —Ñ–∞–π–ª—É', 'error');
                }
            }
            
            exportOrders() {
                const dataStr = JSON.stringify(this.orders, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `orders_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.showNotification('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ —É JSON —Ñ–æ—Ä–º–∞—Ç—ñ', 'success');
            }
            
            showNotification(message, type = 'success') {
                // –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
                document.querySelectorAll('.notification').forEach(n => n.remove());
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">
                        ${type === 'success' ? '‚úÖ' : '‚ùå'}
                    </div>
                    <div class="notification-text">${message}</div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in forwards';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }
            
            showError(message) {
                const ordersList = document.getElementById('ordersList');
                ordersList.innerHTML = `
                    <div class="empty-orders">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <h3 style="color: #f94144; margin-bottom: 10px;">–ü–æ–º–∏–ª–∫–∞</h3>
                        <p style="color: #8d99ae;">${message}</p>
                    </div>
                `;
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function refreshOrders() {
            window.adminPanel.loadOrders();
        }
        
        function clearOrdersFile() {
            window.adminPanel.clearOrdersFile();
        }
        
        function exportOrders() {
            window.adminPanel.exportOrders();
        }
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', () => {
            window.adminPanel = new AdminPanel();
        });
    </script>
</body>
</html>