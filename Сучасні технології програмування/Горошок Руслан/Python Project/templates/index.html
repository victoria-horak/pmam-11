<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>TrafficInsight</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="icon" type="image/png" href="/static/Traffic-icon.png">
</head>
<body>
  <h2>ТрафікАналітика транспортного навантаження міста</h2>

  <div id="control-panel">
    <div class="panel-row">
      <label for="view-mode" class="panel-label">Режим:</label>
      <select id="view-mode" class="panel-select">
        <option value="full">Аварії та ремонтні роботи</option>
        <option value="day">Порівняння по днях</option>
      </select>
    </div>
    <form id="address-form" class="panel-form">
      <input type="text" id="origin_address" placeholder="Початкова адреса" required>
<div class="custom-dropdown" id="days-dropdown" style="display:none;">
  <div class="dropdown-selected" id="dropdown-selected">
    <span class="dropdown-placeholder">Обрати дні...</span>
    <span class="dropdown-arrow">&#9662;</span>
  </div>
  <div class="dropdown-list" id="dropdown-list"></div>
</div>

      <input type="text" id="destination_address" placeholder="Кінцева адреса" required>
      <label for="roadwork_count" class="panel-label" id="lbl-roadwork">Ремонтні роботи:</label>
      <input type="number" id="roadwork_count" min="0" max="10" value="0">
      <label for="accident_count" class="panel-label" id="lbl-accident">Аварії:</label>
      <input type="number" id="accident_count" min="0" max="10" value="0">
      <button type="submit">Пошук маршруту</button>
      <button type="button" id="train-route">Тренувати маршрут</button>
      <button type="button" id="analyze-data">Аналіз</button>
    </form>
  </div>

  <div id="map"></div>

  <div id="full-mode-panel">
    <div id="main-analytics-content">
      <div style="display: flex; justify-content: space-between; gap: 20px; margin-top: 30px; flex-wrap: wrap;">
        <div style="flex: 1 1 48%;">
          <h3 style="text-align: center;">Дані до тренування</h3>
          <table id="table-original">
            <thead>
              <tr>
                <th>Сегмент</th>
                <th>Коеф. швидкості</th>
                <th>Коеф. часу</th>
                <th>Ремонт</th>
                <th>Аварія</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="flex: 1 1 48%;">
          <h3 style="text-align: center;">Дані після тренування</h3>
          <table id="table-trained">
            <thead>
              <tr>
                <th>Сегмент</th>
                <th>Коеф. швидкості</th>
                <th>Коеф. часу</th>
                <th>Ремонт</th>
                <th>Аварія</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px;">
        <div style="flex: 1 1 45%; text-align: center;">
          <p id="correlation-value" style="font-weight:bold; font-size:16px; margin-bottom:10px;">Коефіцієнт швидкості (впливові)</p>
          <canvas id="correlation-chart" width="700" height="450"></canvas>
        </div>
        <div style="flex: 1 1 45%; text-align: center;">
          <p id="tt-correlation-value" style="font-weight:bold; font-size:16px; margin-bottom:10px;">Коефіцієнт часу (впливові)</p>
          <canvas id="tt-correlation-chart" width="700" height="450"></canvas>
        </div>
      </div>
      <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px;">
        <div style="flex: 1 1 45%; text-align: center;">
          <p id="global-correlation-value" style="font-weight:bold; font-size:16px; margin-bottom:10px;">Коефіцієнт швидкості (всі сегменти)</p>
          <canvas id="global-correlation-chart" width="700" height="450"></canvas>
        </div>
        <div style="flex: 1 1 45%; text-align: center;">
          <p id="tt-global-correlation-value" style="font-weight:bold; font-size:16px; margin-bottom:10px;">Коефіцієнт часу (всі сегменти)</p>
          <canvas id="tt-global-correlation-chart" width="700" height="450"></canvas>
        </div>
      </div>

      <div style="display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; margin-top: 30px;">
        <div style="flex: 1 1 30%; min-width: 350px;">
          <h3 style="text-align: center;">Швидкість: до/після (по сегментах)</h3>
          <canvas id="compare-prediction-chart" width="400" height="350"></canvas>
        </div>
        <div style="flex: 1 1 30%; min-width: 350px;">
          <h3 style="text-align: center;">Відхилення швидкості (Δ: після – до)</h3>
          <canvas id="delta-speed-chart" width="400" height="350"></canvas>
        </div>
        <div style="flex: 1 1 30%; min-width: 350px;">
          <h3 style="text-align: center;">ТОП-5 проблемних сегментів</h3>
          <canvas id="worst-bar-chart" width="400" height="350"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
